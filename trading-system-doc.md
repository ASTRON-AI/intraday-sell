# 當沖交易預測系統文件

## 1. 特徵工程

### 價格相關特徵
- 價格變動特徵：開高低收相對於前一日收盤價的變化幅度
- 日內價格區間特徵：當日高低點範圍、上下影線、實體長度
- 歷史價格特徵：前5天的開高低收價格變化率和累積漲跌幅

### 成交量相關特徵
- 移動平均：5日、10日、20日成交量和成交金額移動平均
- 相對變化：相對於前一日的成交量和金額變化率
- MA比較：當日成交量相對於5日和20日均量的比率

### 融資融券特徵
- 融資特徵：使用率、餘額變動率、買進強度、賣出強度
- 融券特徵：使用率、餘額變動率、賣出強度、買進強度
- 綜合指標：資券比、資券維持率差異
- 5日移動平均：所有融資融券比率的5日均值

### 外資交易特徵
- 基本比率：買進比例、賣出比例、淨買超比例
- 累積數據：1-5天的累積買賣量和比例
- 成交比重：外資交易量占總成交量的比例

## 2. 訓練方法

### 資料處理
1. 資料期間：2023-01-01 至 2024-12-31
2. 資料分割：60% 訓練集、40% 測試集
3. 特徵標準化：使用StandardScaler進行特徵縮放
4. 極端值處理：使用1%和99%分位數進行截斷

### 模型訓練
- 使用XGBoost分類器
- 主要參數設定：
  - max_depth: 6
  - learning_rate: 0.01
  - n_estimators: 1000
  - subsample: 0.8
  - colsample_bytree: 0.8
  - scale_pos_weight: 根據正負樣本比例調整

## 3. 預測方法

### 每日選股流程
1. 過濾不可當沖股票
2. 計算每支股票的預測機率
3. 選擇預測機率最高的前30支股票
4. 根據停損條件進行交易

### 交易規則
- 停損條件：當價格超過前一日收盤價的1.08倍
- 手續費考量：
  - 獲利交易：收取0.2%手續費
  - 虧損交易：收取0.4%手續費

## 4. 績效視覺化

### 權益曲線圖
- 上半部：顯示訓練期和測試期的累積獲利
- 下半部：顯示回撤曲線
- 標註重要績效指標：
  - 總報酬率
  - 最大回撤
  - 夏普比率

### 特徵重要性分析
- 使用XGBoost的feature_importance_
- 生成Top 20重要特徵的長條圖
- 將特徵重要性數據保存為CSV檔案

### 交易統計
- 總交易次數
- 獲利/虧損次數
- 勝率
- 總獲利金額
- 每日平均交易次數

所有分析結果都保存在./analysis_results/目錄下，包括：
- equity_curve_top10.png：權益曲線圖
- features/feature_importance.png：特徵重要性圖
- features/feature_importance.csv：特徵重要性數據
- daily_top10_stocks.csv：每日選股結果